<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Discord-klon demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-[#0f1724] text-white">
    <div id="root"></div>

    <!-- React + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // ðŸ”¹ Auth helper
      function getUser() {
        return localStorage.getItem("discord_user");
      }

      // ðŸ”¹ Login page
      function Login({ onLogin }) {
        const [name, setName] = useState("");

        function handleSubmit(e) {
          e.preventDefault();
          if (name.trim()) {
            localStorage.setItem("discord_user", name.trim());
            onLogin(name.trim());
          }
        }

        return (
          <div className="flex items-center justify-center h-screen bg-[#0f1724]">
            <form
              onSubmit={handleSubmit}
              className="bg-[#1a2236] p-8 rounded-2xl shadow-xl w-80"
            >
              <h1 className="text-2xl font-bold mb-6 text-center">Logga in</h1>
              <input
                type="text"
                placeholder="Ditt namn"
                value={name}
                onChange={(e) => setName(e.target.value)}
                className="w-full p-3 rounded bg-[#0b1220] mb-4 outline-none"
              />
              <button
                type="submit"
                className="w-full bg-[#5865f2] hover:bg-[#4752c4] py-3 rounded font-semibold"
              >
                GÃ¥ in
              </button>
            </form>
          </div>
        );
      }

      // ðŸ”¹ Sidebar (kanaler)
      function Sidebar({ channels, active, setActive }) {
        return (
          <div className="w-64 bg-[#0b1220] p-3 flex flex-col border-r border-black/20">
            <h1 className="text-xl font-bold mb-4">Server Demo</h1>
            {Object.values(channels).map((ch) => (
              <div
                key={ch.id}
                onClick={() => setActive(ch.id)}
                className={`px-3 py-2 rounded cursor-pointer ${
                  active === ch.id ? "bg-white/10" : "hover:bg-white/5"
                }`}
              >
                # {ch.name}
              </div>
            ))}
          </div>
        );
      }

      // ðŸ”¹ Members list
      function Members() {
        const members = ["Anna", "BjÃ¶rn", "Cara"];
        return (
          <div className="w-64 bg-[#071428] p-3 border-l border-black/20">
            <h2 className="font-semibold mb-2">Medlemmar</h2>
            {members.map((m) => (
              <div
                key={m}
                className="flex items-center gap-2 px-2 py-1 hover:bg-white/5 rounded"
              >
                <div className="w-8 h-8 rounded-full bg-[#1e2a3a] flex items-center justify-center">
                  {m[0]}
                </div>
                <span>{m}</span>
              </div>
            ))}
          </div>
        );
      }

      // ðŸ”¹ Messages
      function Messages({ messages }) {
        return (
          <div className="flex-1 overflow-auto p-6">
            <div className="flex flex-col gap-4 max-w-2xl">
              {messages.map((m) => (
                <div key={m.id} className="flex gap-3">
                  <div className="w-10 h-10 bg-[#20324a] rounded-full flex items-center justify-center">
                    {m.user[0]}
                  </div>
                  <div>
                    <div className="flex gap-2 items-center">
                      <span className="font-medium">{m.user}</span>
                      <span className="text-xs text-gray-400">
                        {new Date(m.ts).toLocaleTimeString()}
                      </span>
                    </div>
                    <div>{m.text}</div>
                  </div>
                </div>
              ))}
              {messages.length === 0 && (
                <div className="text-gray-400">Inga meddelanden Ã¤n...</div>
              )}
            </div>
          </div>
        );
      }

      // ðŸ”¹ Input
      function MessageInput({ onSend, active }) {
        const ref = useRef();

        function handleSend() {
          if (ref.current.value.trim()) {
            onSend(ref.current.value);
            ref.current.value = "";
          }
        }

        return (
          <div className="p-4 border-t border-black/20">
            <div className="max-w-2xl mx-auto flex gap-2">
              <input
                ref={ref}
                placeholder={`Skriv i #${active}...`}
                className="flex-1 bg-[#071225] rounded px-4 py-2 outline-none"
              />
              <button
                onClick={handleSend}
                className="bg-blue-500 px-4 rounded hover:bg-blue-600"
              >
                Skicka
              </button>
            </div>
          </div>
        );
      }

      // ðŸ”¹ Chat page
      function Chat({ user, onLogout }) {
        const [channels, setChannels] = useState(() => {
          const saved = localStorage.getItem("discord_channels");
          return (
            (saved && JSON.parse(saved)) || {
              general: { id: "general", name: "general", messages: [] },
              random: { id: "random", name: "random", messages: [] },
            }
          );
        });

        const [active, setActive] = useState("general");

        useEffect(() => {
          localStorage.setItem("discord_channels", JSON.stringify(channels));
        }, [channels]);

        function sendMessage(text) {
          const msg = {
            id: Date.now().toString(),
            user,
            text,
            ts: new Date().toISOString(),
          };
          setChannels((prev) => {
            const copy = { ...prev };
            copy[active].messages = [...copy[active].messages, msg];
            return copy;
          });
        }

        return (
          <div className="flex h-screen">
            <Sidebar channels={channels} active={active} setActive={setActive} />
            <div className="flex-1 flex flex-col">
              <div className="flex justify-between items-center px-6 py-4 border-b border-black/30">
                <h2 className="font-semibold text-lg">#{channels[active].name}</h2>
                <button
                  onClick={() => {
                    localStorage.removeItem("discord_user");
                    onLogout();
                  }}
                  className="bg-red-500/30 px-3 py-1 rounded hover:bg-red-500/50"
                >
                  Logga ut
                </button>
              </div>
              <Messages messages={channels[active].messages} />
              <MessageInput onSend={sendMessage} active={active} />
            </div>
            <Members />
          </div>
        );
      }

      // ðŸ”¹ Root App
      function App() {
        const [user, setUser] = useState(getUser());
        return !user ? (
          <Login onLogin={(u) => setUser(u)} />
        ) : (
          <Chat user={user} onLogout={() => setUser(null)} />
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
